(function($){Drupal.behaviors.jcarousel={};Drupal.behaviors.jcarousel.attach=function(context,settings){settings=settings||Drupal.settings;if(!settings.jcarousel||!settings.jcarousel.carousels)return;$("ul.jcarousel li").css("display","");$.each(settings.jcarousel.carousels,function(key,options){var $carousel=$(options.selector+":not(.jcarousel-processed)",context);if(!$carousel.length)return;$.each(options,function(optionKey){if(optionKey.match(/Callback$/)&&typeof options[optionKey]=="string"){var callbackFunction=
window;var callbackParents=options[optionKey].split(".");$.each(callbackParents,function(objectParent){callbackFunction=callbackFunction[callbackParents[objectParent]]});options[optionKey]=callbackFunction}});if(options.ajax&&!options.itemLoadCallback)options.itemLoadCallback=Drupal.jcarousel.ajaxLoadCallback;if(options.auto&&options.autoPause&&!options.initCallback)options.initCallback=function(carousel,state){Drupal.jcarousel.autoPauseCallback(carousel,state)};if(options.responsive&&!options.reloadCallback){options.vertical=
false;options.visible=null;options.reloadCallback=Drupal.jcarousel.reloadCallback}if(!options.setupCallback){options.setupCallback=function(carousel){Drupal.jcarousel.setupCarousel(carousel);if(options.navigation)Drupal.jcarousel.addNavigation(carousel,options.navigation);if(options.responsive)carousel.reload()};if(options.navigation&&!options.itemVisibleInCallback)options.itemLastInCallback={onAfterAnimation:Drupal.jcarousel.updateNavigationActive}}if(!options.hasOwnProperty("buttonNextHTML")&&!options.hasOwnProperty("buttonPrevHTML")){options.buttonNextHTML=
Drupal.theme("jCarouselButton","next");options.buttonPrevHTML=Drupal.theme("jCarouselButton","previous")}$carousel.addClass("jcarousel-processed").jcarousel(options)})};Drupal.jcarousel={};Drupal.jcarousel.reloadCallback=function(carousel){carousel.container.css("width","auto");carousel.clip.css("width","auto");var clipWidth=carousel.clip.width();var containerExtra=carousel.container.width()-carousel.clip.outerWidth(true);var itemWidth=carousel.list.find("li").first().outerWidth(true);var numItems=
Math.floor(carousel.clip.width()/itemWidth)||1;carousel.options.scroll=numItems;var newClipWidth=numItems*itemWidth;var newContainerWidth=newClipWidth+containerExtra;carousel.clip.width(newClipWidth);carousel.container.width(newContainerWidth)};Drupal.jcarousel.ajaxLoadCallback=function(jcarousel,state){if(state=="init"||jcarousel.has(jcarousel.first,jcarousel.last))return;var $list=jcarousel.list;var $view=$list.parents(".view:first");var ajaxPath=Drupal.settings.jcarousel.ajaxPath;var target=$view.get(0);
var settings;$.each(Drupal.settings.jcarousel.carousels,function(domID,carouselSettings){if($list.is("."+domID))settings=carouselSettings["view_options"]});var viewData={"js":1,"first":jcarousel.first-1,"last":jcarousel.last};$.extend(viewData,settings);$.ajax({url:ajaxPath,type:"GET",data:viewData,success:function(response){Drupal.jcarousel.ajaxResponseCallback(jcarousel,target,response)},error:function(xhr){Drupal.jcarousel.ajaxErrorCallback(xhr,ajaxPath)},dataType:"json"})};Drupal.jcarousel.autoPauseCallback=
function(carousel,state){function pauseAuto(){carousel.stopAuto()}function resumeAuto(){carousel.startAuto()}carousel.clip.hover(pauseAuto,resumeAuto);carousel.buttonNext.hover(pauseAuto,resumeAuto);carousel.buttonPrev.hover(pauseAuto,resumeAuto)};Drupal.jcarousel.setupCarousel=function(carousel){carousel.pageSize=carousel.last-(carousel.first-1);var itemCount=carousel.options.size?carousel.options.size:$(carousel.list).children("li").length;carousel.pageCount=Math.ceil(itemCount/carousel.pageSize);
carousel.pageNumber=1;if(carousel.options.wrap!="circular"&&carousel.pageCount==1)carousel.buttons(false,false);carousel.buttonNext.css("display","");carousel.buttonPrev.css("display","")};Drupal.jcarousel.addNavigation=function(carousel,position){if(carousel.pageCount<=1)return;$(carousel.list).parents(".jcarousel-container:first").addClass("jcarousel-navigation-"+position);var navigation=$('<ul class="jcarousel-navigation"></ul>');for(var i=1;i<=carousel.pageCount;i++){var pagerItem=$(Drupal.theme("jCarouselPageLink",
i));var listItem=$("<li></li>").attr("jcarousel-page",i).append(pagerItem);navigation.append(listItem);if(i===1)listItem.addClass("active");pagerItem.bind("click",function(){var newPageNumber=$(this).parent().attr("jcarousel-page");var itemOffset=(newPageNumber-carousel.pageNumber)*carousel.pageSize;if(itemOffset)carousel.scroll(carousel.first+itemOffset);return false})}$(carousel.list).parents(".jcarousel-clip:first")[position](navigation)};Drupal.jcarousel.updateNavigationActive=function(carousel,
item,idx,state){var $listItems=$(carousel.list).parents(".jcarousel-container:first").find(".jcarousel-navigation li");if($listItems.length==0)return;var pageNumber=Math.ceil(idx/carousel.pageSize);if(pageNumber<=0||pageNumber>carousel.pageCount){pageNumber=pageNumber%carousel.pageCount;pageNumber=pageNumber==0?carousel.pageCount:pageNumber;pageNumber=pageNumber<0?pageNumber+carousel.pageCount:pageNumber}carousel.pageNumber=pageNumber;var currentPage=$listItems.get(carousel.pageNumber-1);$listItems.not(currentPage).removeClass("active");
$(currentPage).addClass("active")};Drupal.jcarousel.ajaxResponseCallback=function(jcarousel,target,response){if(response.debug)alert(response.debug);var $view=$(target);var jcarousel=$view.find("ul.jcarousel").data("jcarousel");$("ul.jcarousel > li",response.display).each(function(i){var itemNumber=this.className.replace(/.*?jcarousel-item-(\d+).*/,"$1");jcarousel.add(itemNumber,this.innerHTML)});Drupal.attachBehaviors(jcarousel.list.get(0));if(response.messages)$view.find(".views-messages").remove().end().prepend(response.messages)};
Drupal.jcarousel.ajaxErrorCallback=function(xhr,path){var error_text="";if(xhr.status==500&&xhr.responseText||xhr.status==200){error_text=xhr.responseText;error_text=error_text.replace("/&(lt|gt);/g",function(m,p){return p=="lt"?"<":">"});error_text=error_text.replace(/<("[^"]*"|'[^']*'|[^'">])*>/gi,"");error_text=error_text.replace(/[\n]+\s+/g,"\n")}else if(xhr.status==500)error_text=xhr.status+": "+Drupal.t("Internal server error. Please see server or PHP logs for error information.");else error_text=
xhr.status+": "+xhr.statusText;alert(Drupal.t("An error occurred at @path.\n\nError Description: @error",{"@path":path,"@error":error_text}))};Drupal.theme.prototype.jCarouselButton=function(type){return'<a href="javascript:void(0)"></a>'};Drupal.theme.prototype.jCarouselPageLink=function(pageNumber){return'<a href="javascript:void(0)"><span>'+pageNumber+"</span></a>"}})(jQuery);