(function($){var appFields={},appWindow=(top.appiFrm||window).opener||parent;imce.hooks.load.push(function(win){var index=location.href.lastIndexOf("app=");if(index==-1)return;var data=decodeURIComponent(location.href.substr(index+4)).split("|");var arr,prop,str,func,appName=data.shift();for(var i=0,len=data.length;i<len;i++){str=data[i];if(!str.length)continue;if(str.indexOf("&")!=-1)str=str.split("&")[0];arr=str.split("@");if(arr.length>1){prop=arr.shift();appFields[prop]=arr.join("@")}}if(appFields.imceload&&
(func=isFunc(appFields.imceload))){func(win);delete appFields.imceload}var sendtoFunc=appFields.url?appFinish:false;if(appFields.sendto&&(func=isFunc(appFields.sendto))){sendtoFunc=func;delete appFields.sendto}else if(win.name&&(func=isFunc(win.name+"ImceFinish")))sendtoFunc=func;if(appFields.url){if(appFields.url.indexOf(",")>-1){var arr=appFields.url.split(",");for(var i in arr)if($("#"+arr[i],appWindow.document).length){appFields.url=arr[i];break}}var filename=$("#"+appFields.url,appWindow.document).val()||
"";imce.highlight(filename.substr(filename.lastIndexOf("/")+1))}sendtoFunc&&imce.setSendTo(Drupal.t("Insert file"),sendtoFunc)});var appFinish=function(file,win){var $doc=$(appWindow.document);for(var i in appFields)$doc.find("#"+appFields[i]).val(file[i]);if(appFields.url)try{$doc.find("#"+appFields.url).blur().change().focus()}catch(e){try{$doc.find("#"+appFields.url).trigger("onblur").trigger("onchange").trigger("onfocus")}catch(e){}}appWindow.focus();win.close()};var isFunc=function(str,scope){var obj=
scope||appWindow;var parts=str.split("."),len=parts.length;for(var i=0;i<len&&(obj=obj[parts[i]]);i++);return obj&&i==len&&(typeof obj=="function"||typeof obj!="string"&&!obj.nodeName&&obj.constructor!=Array&&/^[\s[]?function/.test(obj.toString()))?obj:false}})(jQuery);